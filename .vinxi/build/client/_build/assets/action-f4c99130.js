import{y,z as O,f as A,e as R}from"./web-cfb96051.js";import{i as S,m as C,r as b}from"./routing-96fb575a.js";const M=18e4;let c=new Map;setInterval(()=>{const t=Date.now();for(let[e,n]of c.entries())!n[3].size&&t-n[0]>M&&c.delete(e)},3e5);function j(t,e=!0){return y(()=>{const n=Date.now();g(t,o=>{e&&(o[0]=0),B(o[3],n)})})}function g(t,e){t&&!Array.isArray(t)&&(t=[t]);for(let n of c.keys())(t===void 0||E(n,t))&&e(c.get(n))}function B(t,e){for(let n of t)n[1](e)}function E(t,e){for(let n of e)if(t.startsWith(n))return!0;return!1}function K(t){return JSON.stringify(t,(e,n)=>P(n)?Object.keys(n).sort().reduce((o,r)=>(o[r]=n[r],o),{}):n)}function P(t){let e;return t!=null&&typeof t=="object"&&(!(e=Object.getPrototypeOf(t))||e===Object.prototype)}const p=new Map;function z(t){const e=S();return(...n)=>t.apply(e,n)}function D(t,e){function n(...r){const s=t(...r),[l,h]=R();let d;const u=this;async function a(f){const i=await U(f,u.navigatorFactory());return i?h({data:i}):d.clear(),i}return u.submissions[1](f=>[...f,d={input:r,url:o,get result(){return l()?.data},get pending(){return!l()},clear(){u.submissions[1](i=>i.filter(m=>m.input!==r))},retry(){h(void 0);const i=t(...r);return i.then(a,a),i}}]),s.then(a,a),s}const o=t.url||e&&`https://action/${e}`||`https://action/${T(t.toString())}`;return w(n,o)}function w(t,e){return t.toString=()=>{if(!e)throw new Error("Client Actions need explicit names if server rendered");return e},t.with=function(...n){const o=function(...s){return t.call(this,...n,...s)},r=new URL(e,C);return r.searchParams.set("args",K(n)),w(o,(r.origin==="https://action"?r.origin:"")+r.pathname+r.search)},t.url=e,p.set(e,t),O()&&A(()=>p.delete(e)),t}const T=t=>t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0);async function U(t,e){let n,o;if(t instanceof Response){if(t.headers.has("X-Revalidate")&&(o=t.headers.get("X-Revalidate").split(",")),t.customBody&&(n=await t.customBody()),b.has(t.status)){const r=t.headers.get("Location")||"/";r.startsWith("http")?window.location.href=r:e(r)}}else n=t;return g(o,r=>r[0]=0),await j(o,!1),n}export{p as a,D as b,z as u};
